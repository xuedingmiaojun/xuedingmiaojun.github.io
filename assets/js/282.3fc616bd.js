(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{570:function(n,i,e){"use strict";e.r(i);var t=e(2),d=Object(t.a)({},function(){var n=this,i=n.$createElement,e=n._self._c||i;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("微信账户体系知识分享"),e("br")]),n._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#unionid"}},[n._v("UnionId")])]),e("li",[e("a",{attrs:{href:"#wxopenid-公众号openid"}},[n._v("wxopenid(公众号OpenId)")])]),e("li",[e("a",{attrs:{href:"#openid"}},[n._v("OpenId")])]),e("li",[e("a",{attrs:{href:"#唯一性"}},[n._v("唯一性")])]),e("li",[e("a",{attrs:{href:"#获取方式"}},[n._v("获取方式")])])])]),e("p"),n._v(" "),e("h3",{attrs:{id:"unionid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#unionid","aria-hidden":"true"}},[n._v("#")]),n._v(" UnionId")]),n._v(" "),e("p",[n._v("一个用户对于同主体微信小程序／公众号／APP的标识，开发者需要在微信开放平台下绑定相同账号的主体。开发者可通过 UnionId，实现多个小程序、公众号、甚至APP 之间的数据互通")]),n._v(" "),e("p",[e("strong",[n._v("正常情况")]),e("br"),n._v("\nUnionId 是用户身份的唯一标识(业务涉及不同主体，不一定)"),e("br"),n._v("\n如果开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过 UnionId 来区分用户的唯一性")]),n._v(" "),e("h3",{attrs:{id:"wxopenid-公众号openid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wxopenid-公众号openid","aria-hidden":"true"}},[n._v("#")]),n._v(" wxopenid(公众号OpenId)")]),n._v(" "),e("ul",[e("li",[n._v("同一个人，关注不同的公众号，会留下不同的wxopenid。大帐号、小帐号因为绑定在一起了，所以会是同一个wxopenid")]),n._v(" "),e("li",[n._v("同一个用户，在同主体的小程序和公众号下，会有各自的 OpenId ，不相同，不能混用"),e("br"),n._v(" "),e("strong",[n._v("以上所有ID均并不包含敏感信息，仅是普通的ID")])])]),n._v(" "),e("h3",{attrs:{id:"openid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openid","aria-hidden":"true"}},[n._v("#")]),n._v(" OpenId")]),n._v(" "),e("ul",[e("li",[n._v("OpenId 是一个用户对于一个小程序／公众号的标识，开发者可以通过这个标识识别出用户")]),n._v(" "),e("li",[n._v("同一个人，使用不同的小程序，会留下不同的小程序 OpenId")]),n._v(" "),e("li",[n._v("获取小程序 OpenId 无需用户操作和授权")])]),n._v(" "),e("h3",{attrs:{id:"唯一性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#唯一性","aria-hidden":"true"}},[n._v("#")]),n._v(" 唯一性")]),n._v(" "),e("ul",[e("li",[n._v("一个人，在同主体的小程序、公众号等下面只有 1 个 UnionId，有多个 wxopenid 和多个小程序OpenId")]),n._v(" "),e("li",[n._v("UnionId是同主体应用下唯一身份证，可以查询对应的wxopenid和小程序OpenId。因此，UnionId 的覆盖率是最高的。当用户关注公众号、逛公众号下面H5时，可以同时获取 UnionId、wxopenid。而逛小程序时，可以同时获取小程序 UnionId、openid。不管逛哪都能拿到 UnionId")]),n._v(" "),e("li",[n._v("单个小程序或公众号里，OpenId 是唯一的。当同一个小程序主体下有多个小程序时，每个小程序有自己的 OpenId，因此需要 UnionId 进行唯一身份标识，即：UnionId 是同个主体下不同小程序的用户唯一标识")])]),n._v(" "),e("h3",{attrs:{id:"获取方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取方式","aria-hidden":"true"}},[n._v("#")]),n._v(" 获取方式")]),n._v(" "),e("p",[n._v("wxopenid")]),n._v(" "),e("ul",[e("li",[n._v("查看：获取设备及用户信息")])]),n._v(" "),e("p",[n._v("OpenId")]),n._v(" "),e("ul",[e("li",[n._v("调用 wx.login ，获取临时登录凭证凭证 code")]),n._v(" "),e("li",[n._v("将 code 传给后端，后端调用接口获取 session_key 和 OpenId")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("https://api.weixin.qq.com/sns/jscode2session?appid=APPID&secret=SECRET&js_code=JSCODE&grant_type=authorization_code\n")])])]),e("p",[n._v("UnionId")]),n._v(" "),e("ul",[e("li",[n._v("前提\n"),e("ul",[e("li",[n._v("微信开放平台帐号已完成开发者资质认证")]),n._v(" "),e("li",[n._v("微信开放平台绑定小程序")])])]),n._v(" "),e("li",[n._v("获取流程\n"),e("ul",[e("li",[n._v("调用接口 wx.getUserInfo ，从解密数据中获取 UnionID。注意本接口需要用户授权，请开发者妥善处理用户拒绝授权后的情况")]),n._v(" "),e("li",[n._v("如果开发者帐号下存在同主体的公众号，并且该用户已经关注了该公众号。开发者可以直接通过 wx.login+ code2Session 获取到该用户 UnionID，无须用户再次授权")]),n._v(" "),e("li",[n._v("如果开发者帐号下存在同主体的公众号或移动应用，并且该用户已经授权登录过该公众号或移动应用。开发者也可以直接通过 wx.login + code2Session 获取到该用户 UnionID ，无须用户再次授权")]),n._v(" "),e("li",[n._v("用户在小程序（暂不支持小游戏）中支付完成后，开发者可以直接通过 getPaidUnionId 接口获取该用户的 UnionID，无需用户授权。注意：本接口仅在用户支付完成后的5分钟内有效，请开发者妥善处理")]),n._v(" "),e("li",[n._v("小程序端调用 云函数 时，如果开发者帐号下存在同主体的公众号，并且该用户已经关注了该公众号，可在云函数中通过 cloud.getWXContext 获取 UnionID")]),n._v(" "),e("li",[n._v("小程序端调用 云函数 时，如果开发者帐号下存在同主体的公众号或移动应用，并且该用户已经授权登录过该公众号或移动应用，也可在云函数中通过 cloud.getWXContext获取 UnionID")])])])])])},[],!1,null,null,null);i.default=d.exports}}]);