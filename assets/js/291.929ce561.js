(window.webpackJsonp=window.webpackJsonp||[]).push([[291],{577:function(t,a,e){"use strict";e.r(a);var s=e(2),r=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("开源一个 vue 项目实现：利用网页授权进行 PC 端扫码登录")]),t._v(" "),e("p",[t._v("之前研究了下微信端扫码登录的实现"),e("router-link",{attrs:{to:"/blog/pc_scan_vs_page_auth.html"}},[t._v("微信网页扫码登录和公众号网页授权登录的比较")]),e("br"),t._v("\n因为微信开放平台的扫码登录需要认证(交钱)，就稍微麻烦一点使用网页授权的方式来做 PC 端扫码登录。")],1),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#实现思路"}},[t._v("实现思路")])]),e("li",[e("a",{attrs:{href:"#涉及技术"}},[t._v("涉及技术")])]),e("li",[e("a",{attrs:{href:"#web-端"}},[t._v("web 端")])]),e("li",[e("a",{attrs:{href:"#服务端"}},[t._v("服务端")])]),e("li",[e("a",{attrs:{href:"#公众号配置"}},[t._v("公众号配置")])]),e("li",[e("a",{attrs:{href:"#在线-demo"}},[t._v("在线 Demo")])]),e("li",[e("a",{attrs:{href:"#参考资料"}},[t._v("参考资料")])])])]),e("p"),t._v(" "),e("h3",{attrs:{id:"实现思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现思路","aria-hidden":"true"}},[t._v("#")]),t._v(" 实现思路")]),t._v(" "),e("p",[t._v("简要介绍")]),t._v(" "),e("blockquote",[e("p",[t._v("PC 端点击扫码登录时会生成一个 uuid 并弹出一个二维码，二维码地址(附带了生成的 uuid)是移动端的网页，微信扫码后打开的是配置好的网页授权链接，通过网页授权的方式获取 code 拿到用户 openid 或者 unionid 后存入数据库中，PC 端通过轮询方式根据生成的 uuid 作为参数来获取用户 id 进行登录")])]),t._v(" "),e("h3",{attrs:{id:"涉及技术"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#涉及技术","aria-hidden":"true"}},[t._v("#")]),t._v(" 涉及技术")]),t._v(" "),e("ul",[e("li",[t._v("vue:2.6.11")]),t._v(" "),e("li",[t._v("vuex:3.1.2")]),t._v(" "),e("li",[t._v("vue-router:3.1.5")]),t._v(" "),e("li",[t._v("vue-qr:2.2.1")]),t._v(" "),e("li",[t._v("element-ui:2.13.0")]),t._v(" "),e("li",[t._v("vant:2.5.3")]),t._v(" "),e("li",[t._v("koa:2.11.0")]),t._v(" "),e("li",[t._v("mongodb:3.6.0")])]),t._v(" "),e("h3",{attrs:{id:"web-端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-端","aria-hidden":"true"}},[t._v("#")]),t._v(" web 端")]),t._v(" "),e("p",[t._v("env 配置")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("ENV = 'development'\nVUE_APP_BASE_API = 'http://localhost:2000'\n\n#appid 可填入申请的测试公众号id或者其它准备好的ID\nVUE_APP_WECHAT_APPID=''\n\n#authUrl 网页授权中间页\nVUE_APP_WECHAT_AUTH_URL='自己的域名/auth.html'\n")])])]),e("p",[t._v("项目部署到服务器上之后可访问 auth.html(即 public 目录下的 auth.html)")]),t._v(" "),e("p",[t._v("安装依赖")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("npm install\n")])])]),e("p",[t._v("开发")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("npm run serve\n")])])]),e("p",[t._v("访问")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:9555\n")])])]),e("p",[t._v("web 端默认使用 9555 端口")]),t._v(" "),e("h3",{attrs:{id:"服务端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务端")]),t._v(" "),e("p",[t._v("数据库服务由 mongodb 的 docker 镜像提供，如果已经安装了 docker 则可通过项目下的脚本启动容器")]),t._v(" "),e("ul",[e("li",[t._v("koa")]),t._v(" "),e("li",[t._v("mongodb(阿里云公开镜像)")])]),t._v(" "),e("p",[t._v("执行"),e("code",[t._v("run-mongo.sh")]),t._v("脚本完成 mongodb 容器启动"),e("br"),t._v("\n创建数据库 runoob(可使用 adminmongo 图形化界面操作)")]),t._v(" "),e("p",[t._v("安装依赖")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("cd server\nnpm install\n")])])]),e("p",[t._v("修改公众号配置，复制一份 config.sample.js 重命名为 config.js 填好如下配置")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  db"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mongodb的连接地址")]),t._v("\n  url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模板消息点击跳转地址")]),t._v("\n  template_id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模板消息ID")]),t._v("\n  appId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 公众号appid")]),t._v("\n  appSecret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 公众号secrect")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("启动服务")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("node app.js\n")])])]),e("p",[t._v("访问地址")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:2000\n")])])]),e("p",[t._v("服务端接口使用 2000 端口")]),t._v(" "),e("h3",{attrs:{id:"公众号配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#公众号配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 公众号配置")]),t._v(" "),e("ul",[e("li",[t._v("授权回调页面域名\n"),e("ul",[e("li",[t._v("项目基于网页授权实现的扫码登录，所以需要在公众号管理后台修改网页授权获取用户基本信息的 "),e("strong",[e("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("授权回调页面域名"),e("OutboundLink")],1)])])])]),t._v(" "),e("li",[t._v("模板消息\n"),e("ul",[e("li",[t._v("如果需要发送登录模板消息则要添加下可用的登录提醒模板")])])])]),t._v(" "),e("h3",{attrs:{id:"在线-demo"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在线-demo","aria-hidden":"true"}},[t._v("#")]),t._v(" 在线 Demo")]),t._v(" "),e("p",[e("a",{attrs:{href:"http://scancode.xuedingmiao.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://scancode.xuedingmiao.com"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("授权回调页面域名"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信网页授权"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站应用微信登录"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("router-link",{attrs:{to:"/blog/pc_scan_vs_page_auth.html"}},[t._v("微信网页扫码登录和公众号网页授权登录的比较")])],1)])])},[],!1,null,null,null);a.default=r.exports}}]);