(window.webpackJsonp=window.webpackJsonp||[]).push([[293],{578:function(e,t,a){"use strict";a.r(t);var r=a(2),n=Object(r.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("本篇文章源于一名同学对近期一篇文章"),a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI3OTA0NDQ3NQ==&mid=2247484406&idx=1&sn=9f58861e88d1d5d28f1ec41306615de0&chksm=eb4c8be2dc3b02f4ffd825e51765b2c29148192e223535e66e119c54af752ba898385d337ae9&scene=21&token=2040604174&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("聊一聊微信小程序包内容"),a("OutboundLink")],1),e._v("的疑问--如何获取文件的 firstMark 之类的数据，借此来展开探究一下。"),a("br")]),e._v(" "),a("h3",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),a("h4",{attrs:{id:"了解下魔数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#了解下魔数","aria-hidden":"true"}},[e._v("#")]),e._v(" 了解下魔数")]),e._v(" "),a("p",[e._v("什么是魔数")]),e._v(" "),a("blockquote",[a("p",[e._v("magic number 一般是指硬写到代码或文件中的整型常量，数值是编程者自己指定的，其他人不知道数值有什么具体意义。")])]),e._v(" "),a("p",[e._v("小程序包也有自己的魔数，这是区别其它文件的标识。")]),e._v(" "),a("h4",{attrs:{id:"了解下大小端序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#了解下大小端序","aria-hidden":"true"}},[e._v("#")]),e._v(" 了解下大小端序")]),e._v(" "),a("ul",[a("li",[e._v("大端序(Big-endian)：高字节保存在内存的低地址--正序排列")]),e._v(" "),a("li",[e._v("小端序(Little-endian)：高字节保存在内存的高地址--逆序排列")])]),e._v(" "),a("p",[a("strong",[e._v("注意")])]),e._v(" "),a("ul",[a("li",[e._v("主机字节顺序，X86一般多为小端（little-endian），网络字节顺序，一般为大端(big-endian)")]),e._v(" "),a("li",[e._v("小程序包是以大端序方式存储的")])]),e._v(" "),a("h3",{attrs:{id:"实验环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实验环境","aria-hidden":"true"}},[e._v("#")]),e._v(" 实验环境")]),e._v(" "),a("ul",[a("li",[e._v("macOS Catalina：v10.15.5")]),e._v(" "),a("li",[e._v("node：v10.17.0")]),e._v(" "),a("li",[e._v("测试小程序包：开源中国小程序")])]),e._v(" "),a("h3",{attrs:{id:"测试用node脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试用node脚本","aria-hidden":"true"}},[e._v("#")]),e._v(" 测试用node脚本")]),e._v(" "),a("p",[e._v("readfile.js"),a("br"),e._v(" "),a("a",{attrs:{"data-fancybox":"",title:"测试用node脚本",href:"http://cdn.xuedingmiao.com/read-header.png"}},[a("img",{staticStyle:{width:"90%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/read-header.png"}})])]),e._v(" "),a("h3",{attrs:{id:"执行脚本结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本结果","aria-hidden":"true"}},[e._v("#")]),e._v(" 执行脚本结果")]),e._v(" "),a("p",[e._v("命令行执行 node readfile.js 得到如下结果")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Header info:\n  Magic number first:  190\n  firstMark: 0xbe\n  unknownInfo:  0\n  infoListLength:  2978\n  dataLength:  923206\n  Magic number last:  237\n  lastMark: 0xed\n")])])]),a("h3",{attrs:{id:"相关脚本若干关键方法解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关脚本若干关键方法解读","aria-hidden":"true"}},[e._v("#")]),e._v(" 相关脚本若干关键方法解读")]),e._v(" "),a("p",[e._v("此段测试脚本摘录自原工具并做了小修改")]),e._v(" "),a("h4",{attrs:{id:"buf-readuint8-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buf-readuint8-0","aria-hidden":"true"}},[e._v("#")]),e._v(" buf.readUInt8(0)")]),e._v(" "),a("p",[e._v("作用：从第0个字节开始读取一个无符号的8比特位整数值(即：从0读一个字节)。"),a("br"),e._v("\n这里是读取一个字节的数据作为 firstMark ，也就是魔数了。如上面执行结果所示，值是一个10进制数字为 190。")]),e._v(" "),a("h4",{attrs:{id:"buf-readuint8-13"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buf-readuint8-13","aria-hidden":"true"}},[e._v("#")]),e._v(" buf.readUInt8(13)")]),e._v(" "),a("p",[e._v("作用：从第13个字节开始读取一个无符号的8比特位整数值。"),a("br"),e._v("\n这里是从第13个字节读取一个字节的数据作为 lastMark ，是另一个魔数。值为 237。")]),e._v(" "),a("h4",{attrs:{id:"firstmark-tostring-16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firstmark-tostring-16","aria-hidden":"true"}},[e._v("#")]),e._v(" firstMark.toString(16)")]),e._v(" "),a("p",[e._v("作用：把数字转换为字符串(以十六进制值显示)"),a("br"),e._v("\n这里数字190的十六进制转换结果为 be ，因为十六进制有前缀 0x ，所以前面需要带前缀以表示十六进制值->"),a("code",[e._v("0xbe")]),e._v("。")]),e._v(" "),a("h4",{attrs:{id:"buf-readuint32be-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buf-readuint32be-5","aria-hidden":"true"}},[e._v("#")]),e._v(" buf.readUInt32BE(5)")]),e._v(" "),a("p",[e._v("作用：以大端字节序从 buf 中第 5 个字节读取一个无符号的 32 位整数值。"),a("br"),e._v("\n这里代表微信文件信息列表长度值。")]),e._v(" "),a("h3",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论","aria-hidden":"true"}},[e._v("#")]),e._v(" 结论")]),e._v(" "),a("p",[e._v("微信小程序包文件的魔数为两个十六进制值 "),a("code",[e._v("0xbe")]),e._v(" 和 "),a("code",[e._v("0xed")]),e._v('，使用其它文件跑脚本会报"Magic number is not correct!"错误。')]),e._v(" "),a("h3",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.runoob.com/jsref/jsref-tostring-number.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("JavaScript toString()方法"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://nodejs.cn/latest-api/buffer/buf_readuint8_offset.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("buf.readUInt8([offset])"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://nodejs.cn/latest-api/buffer/buf_readuint32le_offset.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("buf.readUInt32LE([offset])"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzI3OTA0NDQ3NQ==&mid=2247484406&idx=1&sn=9f58861e88d1d5d28f1ec41306615de0&chksm=eb4c8be2dc3b02f4ffd825e51765b2c29148192e223535e66e119c54af752ba898385d337ae9&scene=21&token=2040604174&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("聊一聊微信小程序包内容"),a("OutboundLink")],1)])])])},[],!1,null,null,null);t.default=n.exports}}]);