(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{428:function(a,t,e){"use strict";e.r(t);var i=e(2),s=Object(i.a)({},function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("分享一次对 JNPF 移动端 uni-app 项目命令行打包 H5 的改造过程"),e("br")]),a._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#问题背景"}},[a._v("问题背景")])]),e("li",[e("a",{attrs:{href:"#可视化界面、vue-cli-命令行创建项目的区别"}},[a._v("可视化界面、vue-cli 命令行创建项目的区别")])]),e("li",[e("a",{attrs:{href:"#uni-app-移动端项目改造步骤"}},[a._v("uni-app 移动端项目改造步骤")])]),e("li",[e("a",{attrs:{href:"#命令行打包h5应用"}},[a._v("命令行打包h5应用")])]),e("li",[e("a",{attrs:{href:"#总结"}},[a._v("总结")])])])]),e("p"),a._v(" "),e("h3",{attrs:{id:"问题背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题背景","aria-hidden":"true"}},[a._v("#")]),a._v(" 问题背景")]),a._v(" "),e("p",[a._v("JNPF 开发平台的移动端是基于 uni-app 进行开发的，所以可以实现多端应用的快速开发。"),e("br"),a._v("\n但是部署流程就略显繁琐了，JNPF 的移动端并不支持命令行调用打包。")]),a._v(" "),e("p",[a._v("这样子的话每次部署h5项目都需要拉取代码然后用工具打包再上传到服务器，太麻烦了，不能容忍。所以为了提高一点效率就需要对JNPF移动端项目进行一定的改造了。")]),a._v(" "),e("p",[a._v("为了更好地学习，在改造之前我们先来了解一下 vue-cli 创建的项目与 HBuilderX 可视化界面创建项目的区别吧。")]),a._v(" "),e("h3",{attrs:{id:"可视化界面、vue-cli-命令行创建项目的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可视化界面、vue-cli-命令行创建项目的区别","aria-hidden":"true"}},[a._v("#")]),a._v(" 可视化界面、vue-cli 命令行创建项目的区别")]),a._v(" "),e("h4",{attrs:{id:"编译器的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译器的区别","aria-hidden":"true"}},[a._v("#")]),a._v(" 编译器的区别")]),a._v(" "),e("p",[e("strong",[a._v("vue-cli")])]),a._v(" "),e("ul",[e("li",[a._v("编译器安装在项目下")]),a._v(" "),e("li",[a._v("升级编译器需要执行 "),e("code",[a._v("npm update")]),a._v(" 或者手动修改 "),e("code",[a._v("package.json")]),a._v(" 中的uni相关依赖版本后执行 "),e("code",[a._v("npm install")])]),a._v(" "),e("li",[a._v("需自己手动 npm 安装 less、scss、ts 等编译器，在 HBuilderX 的插件管理界面安装无效")])]),a._v(" "),e("p",[e("strong",[a._v("HBuilderX")])]),a._v(" "),e("ul",[e("li",[a._v("编译器在 HBuilderX 的安装目录下的 plugin 目录，随着 HBuilderX 的升级会自动升级编译器")])]),a._v(" "),e("p",[e("strong",[a._v("vue-cli 创建项目迁移 HBuilderX")]),e("br"),a._v("\n已经使用 cli 创建的项目，想继续在 HBuilderX 里使用，可以把工程拖到 HBuilderX 中。")]),a._v(" "),e("ul",[e("li",[a._v("如果是把整个项目拖入 HBuilderX，则编译时走的是项目下的编译器。")]),a._v(" "),e("li",[a._v("如果是把 src 目录拖入到 HBuilderX 中，则走的是 HBuilderX 安装目录下plugin 目录下的编译器。")])]),a._v(" "),e("h4",{attrs:{id:"开发工具的区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开发工具的区别","aria-hidden":"true"}},[a._v("#")]),a._v(" 开发工具的区别")]),a._v(" "),e("p",[e("strong",[a._v("vue-cli")])]),a._v(" "),e("ul",[e("li",[a._v("内置 d.ts，可在 vscode、webstorm 等支持 d.ts 的开发工具里正常开发并有语法提示")]),a._v(" "),e("li",[a._v("编译器已经安装到项目下，下载 HBuilderX 时只需下载 10M 的标准版")])]),a._v(" "),e("p",[e("strong",[a._v("HBuilderX")])]),a._v(" "),e("ul",[e("li",[a._v("不带 d.ts")]),a._v(" "),e("li",[a._v("内置了 uni-app 语法提示库")]),a._v(" "),e("li",[a._v("发布 App 时，仍然需要使用 HBuilderX。其他开发工具无法发布 App")])]),a._v(" "),e("p",[a._v("大概了解一下这些区别之后，下面就来讲讲具体改造的步骤。")]),a._v(" "),e("h3",{attrs:{id:"uni-app-移动端项目改造步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uni-app-移动端项目改造步骤","aria-hidden":"true"}},[a._v("#")]),a._v(" uni-app 移动端项目改造步骤")]),a._v(" "),e("h4",{attrs:{id:"_1-环境安装-可选-，如果已经安装了可以忽略此步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境安装-可选-，如果已经安装了可以忽略此步骤","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. 环境安装(可选)，如果已经安装了可以忽略此步骤")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("npm install -g @vue/cli\n")])])]),e("h4",{attrs:{id:"_2-使用-vue-cli-命令行新建项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用-vue-cli-命令行新建项目","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 使用 vue-cli 命令行新建项目")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("vue create -p dcloudio/uni-preset-vue my-project\n")])])]),e("h4",{attrs:{id:"_3-接着选择项目模板-可选择默认模板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-接着选择项目模板-可选择默认模板","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 接着选择项目模板(可选择默认模板)")]),a._v(" "),e("p",[e("a",{attrs:{"data-fancybox":"",title:"默认模板",href:"http://cdn.xuedingmiao.com/uni-cli-template.png"}},[e("img",{staticStyle:{width:"50%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/uni-cli-template.png"}})])]),a._v(" "),e("h4",{attrs:{id:"_4-打开需要改造的-jnpf-移动端项目，复制-src-下的文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-打开需要改造的-jnpf-移动端项目，复制-src-下的文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 4. 打开需要改造的 JNPF 移动端项目，复制 src 下的文件")]),a._v(" "),e("ul",[e("li",[a._v("注意红框内的可以不用复制"),e("br"),a._v(" "),e("a",{attrs:{"data-fancybox":"",title:"JNPF移动端",href:"http://cdn.xuedingmiao.com/jnpf-app-src.png"}},[e("img",{staticStyle:{width:"50%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/jnpf-app-src.png"}})])])]),a._v(" "),e("h4",{attrs:{id:"_5-复制到用-vue-cli-新创建项目的-src-文件夹下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-复制到用-vue-cli-新创建项目的-src-文件夹下","aria-hidden":"true"}},[a._v("#")]),a._v(" 5. 复制到用 vue-cli 新创建项目的 src 文件夹下")]),a._v(" "),e("p",[e("a",{attrs:{"data-fancybox":"",title:"src目录",href:"http://cdn.xuedingmiao.com/uni-app-template.png"}},[e("img",{staticStyle:{width:"50%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/uni-app-template.png"}})])]),a._v(" "),e("h4",{attrs:{id:"_6-修改cli创建项目的入口页及-manifest-json"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-修改cli创建项目的入口页及-manifest-json","aria-hidden":"true"}},[a._v("#")]),a._v(" 6. 修改cli创建项目的入口页及 "),e("code",[a._v("manifest.json")])]),a._v(" "),e("p",[a._v("因为JNPF移动端项目的入口页是main.html，所以需要把main.html的内容拷贝到cli创建项目public目录下的index.html去，然后如果manifest.json设置了打包配置的话那么就需要把配置中h5模板的配置改为"),e("code",[a._v("public/index.html")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('"h5" : {\n    "sdkConfigs" : {\n        "maps" : {}\n    },\n    "title" : "xxx",\n    "template" : "public/index.html",\n    "domain" : "xxx",\n    "devServer": {\n        "port": 8081,\n        "disableHostCheck": true,\n        "proxy": {\n            "/xx": {\n                "target": "xx",\n                "changeOrigin": true,\n                "secure" : false,\n                "pathRewrite": {\n                    "^/xx": ""\n                }\n            }\n        }\n    }\n}\n')])])]),e("h4",{attrs:{id:"_7-接着我们需要稍微改一下根目录下-package-json-的依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-接着我们需要稍微改一下根目录下-package-json-的依赖","aria-hidden":"true"}},[a._v("#")]),a._v(" 7. 接着我们需要稍微改一下根目录下 "),e("code",[a._v("package.json")]),a._v(" 的依赖")]),a._v(" "),e("p",[a._v("对 "),e("code",[a._v("devDependencies")]),a._v(" 增加 "),e("code",[a._v('"@dcloudio/uni-ui": "^1.2.5"')]),a._v(" ，然后就可以执行 "),e("code",[a._v("npm install")]),a._v(" 了。")]),a._v(" "),e("p",[a._v("至此改造就差不多完成了，然后我们就可以尝试去命令行打包h5应用了。")]),a._v(" "),e("h3",{attrs:{id:"命令行打包h5应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令行打包h5应用","aria-hidden":"true"}},[a._v("#")]),a._v(" 命令行打包h5应用")]),a._v(" "),e("p",[a._v("老规矩先执行 "),e("code",[a._v("npm install")]),a._v(" 安装依赖，安装完之后执行 "),e("code",[a._v("npm run build:h5")]),a._v(" 命令尝试打包"),e("br"),a._v("\n不出意外的话会出现以下两种错误")]),a._v(" "),e("p",[e("a",{attrs:{"data-fancybox":"",title:"sass-loader err",href:"http://cdn.xuedingmiao.com/uni-app-build-h5-err1.png"}},[e("img",{staticStyle:{width:"100%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/uni-app-build-h5-err1.png"}})])]),a._v(" "),e("p",[e("a",{attrs:{"data-fancybox":"",title:"node-sass err",href:"http://cdn.xuedingmiao.com/uni-app-build-h5-err2.png"}},[e("img",{staticStyle:{width:"100%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/uni-app-build-h5-err2.png"}})])]),a._v(" "),e("p",[a._v("从错误信息我们可以看出是缺少依赖( sass-loader 和 node-sass 的)。"),e("br"),a._v("\n所以我们分别执行以下命令就可以了")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("npm install --save sass-loader@7.3.1\nnpm install node-sass@4.14.1\n")])])]),e("p",[a._v("也可以通过执行 "),e("code",[a._v("yarn")]),a._v(" 来安装依赖。"),e("br"),a._v("\n安装好依赖之后我们再次执行"),e("code",[a._v("npm run build:h5")]),a._v("尝试打包，可以发现成功了"),e("br"),a._v(" "),e("a",{attrs:{"data-fancybox":"",title:"build",href:"http://cdn.xuedingmiao.com/uni-app-build-h5-success.png"}},[e("img",{staticStyle:{width:"100%",display:"block"},attrs:{src:"http://cdn.xuedingmiao.com/uni-app-build-h5-success.png"}})])]),a._v(" "),e("p",[a._v("然后就可以基于命令行愉快地打包了。")]),a._v(" "),e("h3",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),e("p",[a._v("本次改造是基于 JNPF 的移动端项目但是方法对于其它的 uni-app 项目还是有一定参考价值的，如果遇到项目需要支持命令行打包都可以参照这种做法，希望本文可以帮到有需要的同学们。")])])},[],!1,null,null,null);t.default=s.exports}}]);